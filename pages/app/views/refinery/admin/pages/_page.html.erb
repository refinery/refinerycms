<% # setup params for various action links
   edit_url = refinery.admin_edit_page_path(page.nested_url)
   translated_locales = locales_with_translated_field(page, 'title')
%>

<li class='record page <%= cycle('on', 'on-hover') %>' id='<%= dom_id(page) %>'>
  <div class='item'>
    <%= page_icon(page.children.size) %>
    <%= link_to translated_field(page, :title), edit_url, class: [:title, :edit], title: t('edit') %>
    <%= page_meta_information(page) %>
    <%= edit_in_locales(edit_url, translated_locales) %>

    <span class='actions'>
      <%= action_icon(:preview, page.url, t('.view_live_html')) %>
      <%= action_icon(:add, refinery.new_admin_page_path(parent_id: page.id), t('.new')) %>
      <%= action_icon(:edit, edit_url, t('.edit')) %>
      <%= action_icon(:delete, refinery.admin_delete_page_path(page.nested_url),
                      t('.delete'),
                      class: "cancel confirm-delete",
                      data: { confirm: t('message', scope: 'refinery.admin.delete', title: translated_field(page, :title)) }
          ) if page.deletable? %>
    </span>
  </div>

  <%= content_tag :ul, class: 'nested', data: { 'ajax-content': refinery.admin_children_pages_path(page.nested_url) } do %>
    <%= render(partial: 'page', collection: page.children, cached: ->(child_page) { child_page.self_and_descendants.to_a }) if Refinery::Pages.auto_expand_admin_tree %>
  <% end %>
</li>
