h2. Multiple Resources in an Extension

This guide will show you how to:

* Create multiple tables on one single extension

endprologue.

WARNING: This only works on Refinery versions 2.0.0 and greater.

h4. Generating an extension

Refinery ships with an extension generator that makes adding your own functionality a breeze. It works just like the Rails scaffold generator.

<shell>
$ rails generate refinery:engine singular_model_name attribute:type [attribute:type ...]
</shell>

TIP: to see all the options supported by the +refinery:engine+ generator just run +rails g refinery:engine+.

Here is a list of the different field types are what they give you:

|*field type*|*description*|
|text|a multiline visual editor|
|resource|a link which pops open a dialog which allows the user to select an existing file or upload a new one|
|image|a link which pops open a dialog which allows the  user to select an existing image or upload a new one|
|string and integer|a standard single line text input|

If you remember, we told Rick that we'll give him an area to post up events he'll be at. Although he could technically create a new page in Refinery to add this content there, areas that have special functionality are much better suited as an extension.

Rick is going to want to enter the following information about each event:

* The event title
* The event date
* A photo
* A little blurb about the event.

Run this command to generate the events extension for Rick[1]:

<shell>
$ rails generate refinery:engine event title:string date:datetime photo:image blurb:text
      create  vendor/extensions/events/Gemfile
      create  vendor/extensions/events/Guardfile
      create  vendor/extensions/events/Rakefile
      create  vendor/extensions/events/app/controllers/refinery/events/admin/events_controller.rb
      create  vendor/extensions/events/app/controllers/refinery/events/events_controller.rb
      create  vendor/extensions/events/app/models/refinery/events/event.rb
      create  vendor/extensions/events/app/views/refinery/events/admin/events/_actions.html.erb
      create  vendor/extensions/events/app/views/refinery/events/admin/events/_form.html.erb
      create  vendor/extensions/events/app/views/refinery/events/admin/events/_events.html.erb
      create  vendor/extensions/events/app/views/refinery/events/admin/events/_records.html.erb
      create  vendor/extensions/events/app/views/refinery/events/admin/events/_event.html.erb
      create  vendor/extensions/events/app/views/refinery/events/admin/events/_sortable_list.html.erb
      create  vendor/extensions/events/app/views/refinery/events/admin/events/edit.html.erb
      create  vendor/extensions/events/app/views/refinery/events/admin/events/index.html.erb
      create  vendor/extensions/events/app/views/refinery/events/admin/events/new.html.erb
      create  vendor/extensions/events/app/views/refinery/events/events/index.html.erb
      create  vendor/extensions/events/app/views/refinery/events/events/show.html.erb
      create  vendor/extensions/events/config/locales/en.yml
      create  vendor/extensions/events/config/locales/es.yml
      create  vendor/extensions/events/config/locales/fr.yml
      create  vendor/extensions/events/config/locales/nb.yml
      create  vendor/extensions/events/config/locales/nl.yml
      create  vendor/extensions/events/config/locales/sk.yml
      create  vendor/extensions/events/config/routes.rb
      create  vendor/extensions/events/db/migrate/1_create_events_events.rb
      create  vendor/extensions/events/lib/generators/refinery/events_generator.rb
      create  vendor/extensions/events/lib/refinery/events/engine.rb
      create  vendor/extensions/events/lib/refinery/events.rb
      create  vendor/extensions/events/lib/refinerycms-events.rb
      create  vendor/extensions/events/lib/tasks/refinery/events.rake
      create  vendor/extensions/events/readme.md
      create  vendor/extensions/events/refinerycms-events.gemspec
      create  vendor/extensions/events/script/rails
      create  vendor/extensions/events/spec/models/refinery/events/event_spec.rb
      create  vendor/extensions/events/spec/requests/refinery/events/admin/events_spec.rb
      create  vendor/extensions/events/spec/spec_helper.rb
      create  vendor/extensions/events/spec/support/factories/refinery/events.rb
      create  vendor/extensions/events/tasks/rspec.rake
      create  vendor/extensions/events/tasks/testing.rake
      create  vendor/extensions/events/db/seeds.rb
      append  Gemfile
------------------------
Now run:
bundle install
rails generate refinery:events
rake db:migrate
rake db:seed
------------------------
</shell>

As the output shows next run:

<shell>
$ bundle install
$ rails generate refinery:events
$ rake db:migrate
$ rake db:seed
</shell>

A +refinery:events+ generator is created for you to install the migration to create the events table. Run all the commands provided by in the terminal.

TIP: When new extensions are added, it's a good idea to restart your server for new changes to be loaded in.

As you can see inside your text editor, the event extension is now stored in +vendor/extensions/events/+. This is where all your files &mdash; including your migration file &mdash; will be placed. The folder structure of +events+ is nearly identical to a normal Rails app, but has a few additions to provide Refinery functionality.

Once you have generated an extension, it's time to create another table to put inside of it.

To do that, run the following command. Notice the last argument(+--extension extension_name+). This is how Refinery knows which engine to insert your new code.

TIP: You can additionally specify +--pretend+ to simulate generation, so you may inspect the outcome without actually modifying anything.

<shell>
$ rails g refinery:engine place name:string --extension events --namespace events
   identical  vendor/extensions/events/Gemfile
   identical  vendor/extensions/events/Guardfile
   identical  vendor/extensions/events/Rakefile
      create  vendor/extensions/events/app/controllers/refinery/events/admin/places_controller.rb
      create  vendor/extensions/events/app/controllers/refinery/events/places_controller.rb
      create  vendor/extensions/events/app/models/refinery/events/place.rb
      create  vendor/extensions/events/app/views/refinery/events/admin/places/_actions.html.erb
      create  vendor/extensions/events/app/views/refinery/events/admin/places/_form.html.erb
      create  vendor/extensions/events/app/views/refinery/events/admin/places/_places.html.erb
      create  vendor/extensions/events/app/views/refinery/events/admin/places/_records.html.erb
      create  vendor/extensions/events/app/views/refinery/events/admin/places/_place.html.erb
      create  vendor/extensions/events/app/views/refinery/events/admin/places/_sortable_list.html.erb
      create  vendor/extensions/events/app/views/refinery/events/admin/places/edit.html.erb
      create  vendor/extensions/events/app/views/refinery/events/admin/places/index.html.erb
      create  vendor/extensions/events/app/views/refinery/events/admin/places/new.html.erb
      create  vendor/extensions/events/app/views/refinery/events/places/index.html.erb
      create  vendor/extensions/events/app/views/refinery/events/places/show.html.erb
      create  vendor/extensions/events/config/locales/tmp/en.yml
      create  vendor/extensions/events/config/locales/tmp/es.yml
      create  vendor/extensions/events/config/locales/tmp/fr.yml
      create  vendor/extensions/events/config/locales/tmp/nb.yml
      create  vendor/extensions/events/config/locales/tmp/nl.yml
      create  vendor/extensions/events/config/locales/tmp/sk.yml
      create  vendor/extensions/events/config/tmp/routes.rb
      create  vendor/extensions/events/db/migrate/2_create_events_places.rb
      force  vendor/extensions/events/lib/generators/refinery/events_generator.rb
      create  vendor/extensions/events/lib/refinery/places/engine.rb
      create  vendor/extensions/events/lib/refinery/places.rb
      create  vendor/extensions/events/lib/tmp/refinerycms-events.rb
   identical  vendor/extensions/events/lib/tasks/refinery/events.rake
   identical  vendor/extensions/events/refinerycms-events.gemspec
   identical  vendor/extensions/events/script/rails
      create  vendor/extensions/events/spec/models/refinery/events/place_spec.rb
      create  vendor/extensions/events/spec/requests/refinery/events/admin/places_spec.rb
   identical  vendor/extensions/events/spec/spec_helper.rb
      create  vendor/extensions/events/spec/support/factories/refinery/places.rb
   identical  vendor/extensions/events/tasks/rspec.rake
   identical  vendor/extensions/events/tasks/testing.rake
      remove  vendor/extensions/events/config/locales/tmp
      remove  vendor/extensions/events/config/tmp
      remove  vendor/extensions/events/lib/tmp
------------------------
Now run:
bundle install
rails generate refinery:events
rake db:migrate
rake db:seed
------------------------
</shell>

Run the commands listed above. Notice +rails generate refinery:events places+. The +rails generate refinery:events places+ will copy the migration files from +vendor/extensions/events/db/migrate+ to +db/migrate+ and will prepend a timestamp to each migration. This is so an extension that was written before your application will declare its migrations chronologically later than the migrations you wrote for the app. For instance, if you wrote your app on Tuesday and then inserted the extension on Wednesday, you would want the timestamps on the migrations to show Wednesday rather than the date it was created &mdash; perhaps Monday. If the extension didn't do this, when you deployed your application, it would run the migrations for your extension first, potentially failing because it couldn't find the Refinery database tables it needs to complete.

<shell>
$ bundle install
$ rails generate refinery:events places

You already have a migration called create_events
      create  db/migrate/20110608043313_create_places.rb
   identical  db/seeds/events.rb
      create  db/seeds/places.rb
------------------------
Now run:
rake db:migrate
rake db:seed
------------------------
</shell>

Lastly, run +rake db:migrate+ and +rake db:seed+ as usual.
