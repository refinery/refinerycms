<%= error_messages_for :user %>
<% form_for [:admin, @user] do |f| %>
  <div class='field'>
    <%= f.label :login %>
    <%= f.text_field :login %>
  </div>
  <div class='field'>
    <%= f.label :email %>
    <%= f.text_field :email %>
  </div>
  <div class='field'>
    <%= f.label :password %>
    <%= f.password_field :password %><br />
    <% unless @user.new_record? %>
    <span class="preview"><%=t('.blank_password_keeps_current')%></span>
    <% end %>
  </div>
  <div class='field'>
    <%= f.label :password_confirmation %>
    <%= f.password_field :password_confirmation %>
  </div>
  <div class='field'>
    <%= f.label :plugin_access %>
    <ul id='plugins'>
      <% @available_plugins.each do |plugin| -%>
        <%# Since the dashboard is always included by the framework, this will maintain the user's order %>
        <% if Refinery::Plugins.always_allowed.names.include?(plugin.name) or (plugin.name == 'refinery_users' and @user.id == current_user.id) %>
          <%= hidden_field_tag 'user[plugins][]', plugin.name %>
        <% else %>
          <li>
            <%= check_box_tag 'user[plugins][]', plugin.name, @selected_plugin_names.include?(plugin.name), :id => "plugins_#{plugin.name}" %>
            <%= f.label 'user[plugins][]', plugin.title, :class => "stripped", :for => "plugins_#{plugin.name}" %>
          </li>
        <% end %>
      <% end %>
    </ul>
  </div>
  <%= render :partial => "/shared/admin/form_actions", :locals => {:f => f, :continue_editing => false} %>

<% end %>
