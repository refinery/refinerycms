<% if refinery_user? && "#{controller_name}##{action_name}" !~ %r{preview#show} %>
  <% unless admin? # all required JS included by backend. %>
    <% content_for :stylesheets, stylesheet_link_tag('refinery/site_bar') unless !!local_assigns[:exclude_css] %>
    <%= yield(:stylesheets) unless local_assigns[:head] || local_assigns[:exclude_css] %>
  <% end -%>
  <div id='site_bar'>
    <div id='site_bar_content' class='clearfix'>
      <%= link_to image_tag("#{"http://refinerycms.com/images/" unless local_request? || request.ssl? }refinery/logo-site-bar.png", :alt => "Refinery (tm) Content Manager"),
                  'http://refinerycms.com',
                  :target => '_blank',
                  :id => 'site_bar_refinery_cms_logo' %>
      <div id='editor_switch'>
        <%= site_bar_switch_link -%>
        <% if @page %>
          <%= link_to "Edit page",
                      refinery.edit_admin_page_path(@page.nested_url, :switch_locale => (@page.translations.first.locale unless @page.translated_to_default_locale?)),
                      :title => t('edit', :scope => 'refinery.admin.pages'),
                      class: "button",
                      'data-no-turbolink' => true %>
        <% end %>
        <% if @edit_path %>
          <%= link_to "Edit resource",
                    @edit_path,
                    :title => t('edit', :scope => 'refinery.admin.pages'),
                    class: "button",
                    'data-no-turbolink' => true %>
        <% end %>
      </div>

      <div class='refinerycms-site_bar-user'>
        <% if refinery_user? && current_refinery_user.can_edit?(current_refinery_user) %>
          <%= link_to current_refinery_user.username,
                      refinery.edit_admin_user_path(current_refinery_user),
                      :title => t('edit', :scope => 'refinery.admin.users'),
                      class:"refinerycms-site_bar-user-name",
                      'data-no-turbolink' => true %>
        <% end %>
        <%= link_to t('.log_out', site_bar_translate_locale_args),
                    refinery.logout_path,
                    class: "button",
                    :id => 'logout' %>
      </div>
    </div>
  </div>
<% end %>
